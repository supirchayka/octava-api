# Алгоритм загрузки интерьерной галереи для главной страницы (админка)

Документ описывает, как административный фронтенд должен работать с галереей интерьера на главной странице: какие шаги выполнять, какое тело отправлять и что ждать в ответ, чтобы данные корректно подставлялись из реальной БД.

## Что отдает API
- `GET /admin/pages/home` возвращает блок `interior` с `text` и `images`. Каждый элемент `images` содержит `id`, `fileId`, `url`, `alt`, `caption`, `order` и строится напрямую из записей `HomeGalleryImage` в БД (без сидовых моков). Поля `alt` и `caption` берутся из сохраненных значений, а при их отсутствии `alt` подставляется из `originalName` файла. 【F:src/services/admin-pages.service.ts†L271-L353】
- Маршрут защищен `Authorization: Bearer <token>` и использует единую схему тела для `PUT /admin/pages/home`, где `interiorImages` описаны как массив объектов `{ fileId, alt?, caption?, order? }`. 【F:src/routes/admin-pages.routes.ts†L18-L104】

## Порядок действий для загрузки/редактирования галереи
1. **Загрузить все новые файлы** через `POST /admin/files/upload` и сохранить их `id`. Эти `fileId` потребуются в теле `PUT`.
2. **Подтянуть текущее состояние формы** запросом `GET /admin/pages/home`, чтобы отрисовать уже сохраненные `interior.images` из БД и сохранить их `fileId`/`id`/`order`.
3. **Собрать массив `interiorImages`** в нужном порядке. Каждый объект должен содержать:
   - `fileId` — обязателен для каждого элемента (используйте id свежезагруженного файла или уже существующего элемента);
   - `alt` и `caption` — опциональны; если не передать `alt`, в ответе будет использовано имя файла;
   - `order` — опционален, но лучше передавать явное число, чтобы зафиксировать сортировку. Если поле опущено, порядок выставится по индексу массива.
4. **Отправить `PUT /admin/pages/home`** с телом вида:
   ```json
   {
     "interiorText": "Краткое описание блока интерьера",
     "interiorImages": [
       { "fileId": 101, "alt": "Холл", "caption": "Зона ожидания", "order": 0 },
       { "fileId": 102, "alt": "Кабинет", "order": 1 }
     ]
   }
   ```
   - Массив передается целиком: сервер сначала удаляет все записи `purpose=GALLERY` для страницы, затем создает новые в переданном порядке. Пустой массив очищает галерею. Если `interiorImages` не отправлять, существующая галерея останется без изменений. 【F:src/services/admin-pages.service.ts†L430-L484】
   - Остальные поля (`hero*`, `subhero*`, `directions`, `seo`) можно не включать, если их не нужно обновлять.
5. **Проверить ответ `204 No Content`** и при следующем `GET /admin/pages/home` убедиться, что `interior.images` отражает новый порядок и тексты из БД.

## Задание на проверку и доработку
- Убедиться, что форма админки использует описанный выше алгоритм: обязательная загрузка файлов, построение полного массива `interiorImages` и отправка `PUT` целиком при любом изменении порядка/списка.
- Проверить, что `GET /admin/pages/home` в интерфейсе отображает реальные данные из базы (URL, alt, caption, order), а не сидовые значения.
- Дополнить UI валидацией: не отправлять `PUT`, пока у каждого элемента нет `fileId`, и предлагать задать `order`, если требуется фиксированная сортировка.
